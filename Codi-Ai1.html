<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì½”ë”” ì¶”ì²œ â€” í™•ì¥ MVP (í”¼ë¶€í†¤ 12ì‹œì¦Œ)</title>
  <style>
    :root { --gap: 12px; --radius: 14px; --focus: 2px solid #111; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif; margin:0; background:#f7f7fb; color:#111; }
    .wrap { max-width: 980px; margin: 32px auto; padding: 0 16px; }
    header { display:flex; gap:var(--gap); flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom: 16px; }
    h1 { font-size: clamp(20px, 4vw, 28px); margin:0; }
    .lang { display:flex; gap:8px; }
    .lang button { padding:8px 10px; border:1px solid #d8d8e1; background:#fff; border-radius:10px; }
    .card { background:#fff; border:1px solid #e9e9ef; border-radius: var(--radius); padding: 18px; box-shadow: 0 2px 8px rgba(0,0,0,.04); }
    .grid { display:grid; grid-template-columns: repeat(12, 1fr); gap: var(--gap); }
    .col-4 { grid-column: span 4; } .col-6{ grid-column: span 6; } .col-12{ grid-column: span 12; }
    @media (max-width: 720px){ .col-4, .col-6 { grid-column: span 12; } }
    label { display:block; font-weight:600; margin-bottom:6px; }
    select, input[type="number"], button { width:100%; padding:10px 12px; border-radius: 10px; border:1px solid #d8d8e1; background:#fff; }
    input:focus, select:focus, button:focus { outline: var(--focus); outline-offset: 2px; }
    button { cursor:pointer; font-weight:700; }
    .primary { background:#111; color:#fff; border-color:#111; }
    .result { margin-top: 18px; display:none; }
    .result h3 { margin: 0 0 8px; }
    .tags { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;}
    .tag { border:1px solid #ddd; border-radius:999px; padding:6px 10px; font-size: 13px; background:#fafafa; }
    .tip { padding:12px; border-left:4px solid #111; background:#fafafa; border-radius:8px; }
    .muted { color:#666; font-size: 13px; }
    .hr { height:1px; background:#eee; margin:14px 0; }
    .pill { display:inline-flex; align-items:center; gap:8px; border:1px solid #ddd; padding:8px 10px; border-radius:999px; }
    .row { display:flex; gap:var(--gap); flex-wrap:wrap; align-items:center; }
    .heart { cursor:pointer; user-select:none; }
    .toast { position: fixed; left:50%; transform:translateX(-50%); bottom:24px; background:#111; color:#fff; padding:10px 14px; border-radius:12px; display:none; }
    footer { margin: 22px 0 40px; color:#666; font-size:13px; }
    .hidden { display:none !important; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 id="title" aria-live="polite">ë‚˜ì´Â·ì„±ë³„Â·ì²´í˜•Â·ìƒí™©ë³„ ì½”ë”” ì¶”ì²œ</h1>
      <div class="lang" role="group" aria-label="ì–¸ì–´ ì„ íƒ">
        <button type="button" data-lang="ko" aria-pressed="true">í•œêµ­ì–´</button>
        <button type="button" data-lang="en" aria-pressed="false">English</button>
        <button type="button" data-lang="ja" aria-pressed="false">æ—¥æœ¬èª</button>
      </div>
    </header>

    <section class="card" aria-labelledby="form-title">
      <div class="row" style="justify-content:space-between; margin-bottom:6px;">
        <h2 id="form-title" style="margin:0;">ê¸°ë³¸ ì„ íƒ</h2>
        <!-- ì‹¤í—˜ ë°°ì§€ ë¬¸êµ¬ ì‚­ì œ ìš”ì²­ â†’ ìˆ¨ê¹€ -->
        <span id="variantBadge" class="hidden" aria-hidden="true"></span>
      </div>

      <div class="grid" role="form">
        <!-- ë‚˜ì´/ì„±ë³„ -->
        <div class="col-4">
          <label for="age">ë‚˜ì´ëŒ€</label>
          <select id="age" aria-describedby="ageHelp">
            <option value="10">10ëŒ€</option>
            <option value="20">20ëŒ€</option>
            <option value="30">30ëŒ€</option>
            <option value="40">40ëŒ€</option>
            <option value="50">50ëŒ€</option>
          </select>
          <div id="ageHelp" class="muted">ëŒ€ëµì ì¸ ìŠ¤íƒ€ì¼ ë¬´ë“œì— ì‚¬ìš©</div>
        </div>
        <div class="col-4">
          <label for="gender">ì„±ë³„</label>
          <select id="gender">
            <option value="female">ì—¬ì„±</option>
            <option value="male">ë‚¨ì„±</option>
            <option value="unisex">ìœ ë‹ˆì„¹ìŠ¤</option>
          </select>
        </div>

        <!-- ì •ë°€ ì²´í˜• ì…ë ¥ -->
        <div class="col-4">
          <label>ì‹ ì²´ ì •ë³´ <span class="muted">(ì„ íƒ)</span></label>
          <div class="row">
            <span class="pill" aria-label="í‚¤ ì…ë ¥">
              <span>í‚¤</span>
              <input id="height" type="number" inputmode="decimal" min="130" max="220" placeholder="cm" aria-label="í‚¤ (cm)" style="width:90px">
              <span class="muted">cm</span>
            </span>
            <span class="pill" aria-label="ëª¸ë¬´ê²Œ ì…ë ¥">
              <span>ëª¸ë¬´ê²Œ</span>
              <input id="weight" type="number" inputmode="decimal" min="30" max="200" placeholder="kg" aria-label="ëª¸ë¬´ê²Œ (kg)" style="width:90px">
              <span class="muted">kg</span>
            </span>
          </div>
          <div class="row" style="margin-top:8px">
            <span class="pill">
              <span>í—ˆë¦¬</span>
              <input id="waist" type="number" inputmode="decimal" min="50" max="150" placeholder="cm" aria-label="í—ˆë¦¬ ë‘˜ë ˆ (cm)" style="width:90px">
              <span class="muted">cm</span>
            </span>
            <span class="pill">
              <span>ì–´ê¹¨</span>
              <input id="shoulder" type="number" inputmode="decimal" min="30" max="70" placeholder="cm" aria-label="ì–´ê¹¨ ë„ˆë¹„ (cm)" style="width:90px">
              <span class="muted">cm</span>
            </span>
          </div>
          <div class="muted" id="autoShapeNote" aria-live="polite" style="margin-top:6px"></div>
        </div>

        <!-- ìƒí™©/ê³„ì ˆ -->
        <div class="col-6">
          <label for="occasion">ìƒí™©</label>
          <select id="occasion">
            <option value="office">ì¶œê·¼/ì˜¤í”¼ìŠ¤</option>
            <option value="date">ë°ì´íŠ¸</option>
            <option value="travel">ì—¬í–‰/ì£¼ë§</option>
            <option value="formal">ê²©ì‹/í–‰ì‚¬</option>
            <option value="guest">í•˜ê°/ëª¨ì„</option>
          </select>
        </div>
        <div class="col-6">
          <label for="season">ê³„ì ˆ</label>
          <select id="season">
            <option value="spring">ë´„</option>
            <option value="summer">ì—¬ë¦„</option>
            <option value="autumn">ê°€ì„</option>
            <option value="winter">ê²¨ìš¸</option>
          </select>
        </div>

        <!-- í”¼ë¶€í†¤ 12ì‹œì¦Œ -->
        <div class="col-6">
          <label for="skinTone">í”¼ë¶€í†¤ (12ì‹œì¦Œ)</label>
          <select id="skinTone">
            <optgroup label="ë´„(Spring)">
              <option value="springLight">ë´„ ë¼ì´íŠ¸</option>
              <option value="springWarm">ë´„ íŠ¸ë£¨(ì›œ)</option>
              <option value="springBright">ë´„ ë¸Œë¼ì´íŠ¸</option>
            </optgroup>
            <optgroup label="ì—¬ë¦„(Summer)">
              <option value="summerLight">ì—¬ë¦„ ë¼ì´íŠ¸</option>
              <option value="summerCool">ì—¬ë¦„ íŠ¸ë£¨(ì¿¨)</option>
              <option value="summerSoft">ì—¬ë¦„ ì†Œí”„íŠ¸</option>
            </optgroup>
            <optgroup label="ê°€ì„(Autumn)">
              <option value="autumnSoft">ê°€ì„ ì†Œí”„íŠ¸</option>
              <option value="autumnWarm">ê°€ì„ íŠ¸ë£¨(ì›œ)</option>
              <option value="autumnDeep">ê°€ì„ ë”¥</option>
            </optgroup>
            <optgroup label="ê²¨ìš¸(Winter)">
              <option value="winterDeep">ê²¨ìš¸ ë”¥</option>
              <option value="winterCool">ê²¨ìš¸ íŠ¸ë£¨(ì¿¨)</option>
              <option value="winterBright">ê²¨ìš¸ ë¸Œë¼ì´íŠ¸</option>
            </optgroup>
          </select>
        </div>

        <!-- ì‹¤í–‰ ë²„íŠ¼ -->
        <div class="col-12 row" style="margin-top: 4px;">
          <button class="primary" id="recommend"></button>
          <button id="save">í˜„ì¬ ì„¤ì • ì €ì¥</button>
          <button id="reset">ì´ˆê¸°í™”</button>
        </div>
        <!-- Enter ì•ˆë‚´ ë¬¸êµ¬ ì‚­ì œ ìš”ì²­ â†’ ìš”ì†Œ ìì²´ ì œê±° -->
      </div>

      <div class="hr" role="separator" aria-hidden="true"></div>

      <div class="result" id="result" aria-live="polite">
        <h3>ì¶”ì²œ ê²°ê³¼</h3>
        <div class="tip" id="summary"></div>
        <div class="muted" id="benefit"></div><!-- ì¥ì  í•œ ì¤„ -->
        <div class="tags" id="tags"></div>
        <div class="row" style="margin-top:10px">
          <span class="heart" id="likeBtn" role="button" aria-pressed="false" aria-label="ì¶”ì²œ ì¦ê²¨ì°¾ê¸°">ğŸ¤ ì¦ê²¨ì°¾ê¸°</span>
          <!-- ë°ëª¨ ì£¼ì„ë¬¸ ì‚­ì œ ìš”ì²­ â†’ ìˆ¨ê¹€ -->
          <span class="muted hidden" id="note" aria-hidden="true"></span>
        </div>
      </div>
    </section>

    <!-- ê°œì¸í™” â€” ìµœê·¼ ì¶”ì²œ & ì¦ê²¨ì°¾ê¸° -->
    <section class="card" style="margin-top:16px" aria-labelledby="saved-title">
      <h2 id="saved-title" style="margin:0 0 8px">ë‚´ ì €ì¥ ëª©ë¡</h2>
      <div class="grid">
        <div class="col-6">
          <h3 style="margin:4px 0">ìµœê·¼ ì¶”ì²œ</h3>
          <ul id="recentList" aria-live="polite"></ul>
        </div>
        <div class="col-6">
          <h3 style="margin:4px 0">ì¦ê²¨ì°¾ê¸°</h3>
          <ul id="favList" aria-live="polite"></ul>
        </div>
      </div>
    </section>

    <footer>
      <!-- í‘¸í„° ë¬¸êµ¬ ì‚­ì œ ìš”ì²­ â†’ ë¹ˆ ìƒíƒœ ìœ ì§€ -->
    </footer>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // ===== ë‹¤êµ­ì–´(i18n) =====
    const I18N = {
      ko: {
        title:"ë‚˜ì´Â·ì„±ë³„Â·ì²´í˜•Â·ìƒí™©ë³„ ì½”ë”” ì¶”ì²œ",
        ctaA:"ì½”ë”” ì¶”ì²œ ë°›ê¸°",
        ctaB:"ë‚´ ì½”ë”” ë³´ê¸°",
        saved:"ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤",
        cleared:"ì´ˆê¸°í™” ì™„ë£Œ",
        liked:"ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€í–ˆì–´ìš”",
        unliked:"ì¦ê²¨ì°¾ê¸°ì—ì„œ ì œê±°í–ˆì–´ìš”"
      },
      en: {
        title:"Outfits by Age Â· Gender Â· Body Type Â· Occasion",
        ctaA:"Get Suggestions",
        ctaB:"View My Outfit",
        saved:"Saved",
        cleared:"Reset done",
        liked:"Added to favorites",
        unliked:"Removed from favorites"
      },
      ja: {
        title:"å¹´é½¢ãƒ»æ€§åˆ¥ãƒ»ä½“å‹ãƒ»ã‚·ãƒ¼ãƒ³åˆ¥ã‚³ãƒ¼ãƒ‡",
        ctaA:"ã‚³ãƒ¼ãƒ‡ã‚’è¦‹ã‚‹",
        ctaB:"ãƒã‚¤ã‚³ãƒ¼ãƒ‡è¡¨ç¤º",
        saved:"ä¿å­˜ã—ã¾ã—ãŸ",
        cleared:"ãƒªã‚»ãƒƒãƒˆå®Œäº†",
        liked:"ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ",
        unliked:"ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤"
      }
    };
    let LANG = localStorage.getItem("lang") || "ko";
    function t(key){ return (I18N[LANG] && I18N[LANG][key]) || I18N["ko"][key] || key; }
    function applyLang(){
      document.getElementById("title").textContent = t("title");
      document.getElementById("recommend").textContent = EXP.variant==="A"? t("ctaA"): t("ctaB");
      document.querySelectorAll('.lang button').forEach(b=> b.setAttribute('aria-pressed', b.dataset.lang===LANG ? 'true':'false'));
      document.documentElement.lang = LANG;
    }
    document.querySelectorAll('.lang button').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        LANG = btn.dataset.lang; localStorage.setItem("lang", LANG); applyLang();
      });
    });

    // ===== A/B í…ŒìŠ¤íŠ¸ (ë°°ì§€ëŠ” ìˆ¨ê²¨ë‘ , ê¸°ëŠ¥ë§Œ ìœ ì§€) =====
    const EXP = (()=> {
      const key="ab_variant";
      const existing = localStorage.getItem(key);
      const variant = existing || (Math.random()<0.5 ? "A":"B");
      localStorage.setItem(key, variant);
      return { key, variant };
    })();

    function logEvent(name, data={}){
      const payload = { ts: Date.now(), name, variant: EXP.variant, lang: LANG, ...data };
      console.log("[analytics]", payload);
    }

    // ===== ì²´í˜• ìë™ ë¶„ë¥˜ =====
    function autoBodyType(){
      const h = parseFloat(height.value);
      const w = parseFloat(weight.value);
      const waistV = parseFloat(waist.value);
      const shoulderV = parseFloat(shoulder.value);

      let type = null;
      if(!isNaN(h) && !isNaN(w)){
        const bmi = w / Math.pow(h/100, 2);
        if(bmi >= 27) type = "round";
        else if(bmi <= 19) type = "rectangle";
      }
      if(!isNaN(shoulderV) && !isNaN(waistV)){
        const ratio = shoulderV / waistV;
        if(ratio >= 1.25) type = "inverted";
        else if(ratio <= 0.95) type = "triangle";
        else if(ratio >= 1.05 && ratio <= 1.15 && !type) type = "rectangle";
      }
      if(!isNaN(height.value)){
        if(h <= 160) type = type || "petite";
        if(h >= 185) type = type || "tall";
      }

      const msg = type
        ? `ìë™ ì¶”ì • ì²´í˜•: ${prettyShape(type)} (ì…ë ¥ê°’ ê¸°ë°˜)`
        : `ì…ë ¥ê°’ì´ ë¶€ì¡±í•´ìš”. ê¸°ë³¸ ì²´í˜• ë¡œì§ìœ¼ë¡œ ì¶”ì²œí•©ë‹ˆë‹¤.`;
      autoShapeNote.textContent = msg;
      return type;
    }
    function prettyShape(s){
      const map={triangle:"ì‚¼ê°í˜•", inverted:"ì—­ì‚¼ê°í˜•", rectangle:"ì§ì‚¬ê°í˜•", hourglass:"ëª¨ë˜ì‹œê³„", round:"ë¼ìš´ë“œ", petite:"í‚¤ ì‘ì€ ì²´í˜•", tall:"í‚¤ í° ì²´í˜•"};
      return map[s]||s;
    }

    // ===== ê¸°ë³¸ ê·œì¹™ =====
    const baseRules = {
      "10": {
        male:   baseRule("ìŠ¤íŠ¸ë¦¬íŠ¸/ìŠ¤í¬í‹°", ["ë£¨ì¦ˆí• í›„ë“œ","ì¹´ê³ íŒ¬ì¸ ","ìŠ¤ë‹ˆì»¤ì¦ˆ","ìº¡ëª¨ì"]),
        female: baseRule("ìºì£¼ì–¼/ëŸ¬ë¸”ë¦¬", ["í¬ë¡­ ë‹ˆíŠ¸","í”Œë¦¬ì¸  ìŠ¤ì»¤íŠ¸","ìŠ¤ë‹ˆì»¤ì¦ˆ","ìˆ„ë”ë°±"]),
        unisex: baseRule("ë² ì´ì§ ìºì£¼ì–¼", ["ê·¸ë˜í”½ í‹°","ìŠ¤íŠ¸ë ˆì´íŠ¸ ë°ë‹˜","ìº”ë²„ìŠ¤ ìŠˆì¦ˆ","ë°”ì‹œí‹° ìì¼“"])
      },
      "20": {
        male:   baseRule("ë¯¸ë‹ˆë©€ ìºì£¼ì–¼", ["í™”ì´íŠ¸ ì…”ì¸ ","ìŠ¬ë¦¼í• ìŠ¬ë™ìŠ¤","ì²¼ì‹œë¶€ì¸ ","ê°€ì£½ë²¨íŠ¸"]),
        female: baseRule("ì‹œí¬/í˜ë¯¸ë‹Œ", ["ìŠ¬ë¦½ ì›í”¼ìŠ¤","ì˜¤ë²„í• ìì¼“","ì•µí´ë¶€ì¸ ","í¬ë¡œìŠ¤ë°±"]),
        unisex: baseRule("ë°ì¼ë¦¬ ë¯¸ë‹ˆë©€", ["ë‹ˆíŠ¸ í´ë¡œ","ì™€ì´ë“œ ë°ë‹˜","ë¡œí¼","í† íŠ¸ë°±"])
      },
      "30": {
        male:   baseRule("ì„¸ë¯¸ì˜¤í”¼ìŠ¤", ["ì˜¥ìŠ¤í¼ë“œ ì…”ì¸ ","í…Œì´í¼ë“œ ìŠ¬ë™ìŠ¤","ë”ë¹„ìŠˆì¦ˆ","íŠ¸ë Œì¹˜"]),
        female: baseRule("ëª¨ë˜ ì—˜ë ˆê°•ìŠ¤", ["ë¸”ë¼ìš°ìŠ¤","ë¨¸ë©”ì´ë“œ ìŠ¤ì»¤íŠ¸","íŒí”„ìŠ¤","íŠ¸ë Œì¹˜"]),
        unisex: baseRule("ì •ê°ˆí•œ ë°ì¼ë¦¬", ["í¬ë£¨ë„¥ ë‹ˆíŠ¸","ì¹˜ë…¸ íŒ¬ì¸ ","ë¡œí¼","ì½”íŠ¸"])
      },
      "40": {
        male:   baseRule("í´ë˜ì‹ & í¸ì•ˆí•¨", ["ë‹ˆíŠ¸ ê°€ë””ê±´","í¬ë¡­íŠ¸ ìŠ¬ë™ìŠ¤","ë¡œí¼","ê°€ì£½ì‹œê³„"]),
        female: baseRule("ì ˆì œëœ í¬ë©€", ["ì…”ì¸  ì›í”¼ìŠ¤","ë¯¸ë“¤ í","ë‹ˆíŠ¸ ê°€ë””ê±´","ì½”íŠ¸"]),
        unisex: baseRule("ë‰´íŠ¸ëŸ´ í†¤", ["ìºì‹œë¯¸ì–´ ë‹ˆíŠ¸","ì™€ì´ë“œ ìŠ¬ë™ìŠ¤","ì½¤í”¼ ìŠ¤ë‹ˆì»¤ì¦ˆ","ìš¸ì½”íŠ¸"])
      },
      "50": {
        male:   baseRule("í’ˆê²© ìˆëŠ” ë² ì´ì§", ["ë‹ˆíŠ¸ í´ë¡œ","ìš¸ ìŠ¬ë™ìŠ¤","ë¡œí¼","ìŠ¤ì¹´í”„"]),
        female: baseRule("ìš°ì•„í•œ í´ë˜ì‹", ["ì‹¤í¬ ë¸”ë¼ìš°ìŠ¤","Aë¼ì¸ ìŠ¤ì»¤íŠ¸","ë¡œìš°í","ìˆ„"]),
        unisex: baseRule("ì‹¬í”Œ ëŸ­ìŠ¤", ["ì¹´ë””ê±´","í…Œì¼ëŸ¬ë“œ íŒ¬ì¸ ","ì»´í¬íŠ¸ ìŠˆì¦ˆ","ë¡±ì½”íŠ¸"])
      }
    };

    // ===== ì¡°ì • ê·œì¹™ =====
    const shapeAdjust = {
      triangle:  ["ì–´ë‘ìš´ í•˜ì˜","ë°ì€ ìƒì˜","ì–´ê¹¨ ë¼ì¸ ê°•ì¡°","ì¼ì/ì„¸ë¯¸ì™€ì´ë“œ"],
      inverted:  ["ì–´ë‘ìš´ ìƒì˜","ë°ì€ í•˜ì˜","Vë„¥/ê¹Šì€ ë„¤í¬ë¼ì¸","í…Œì´í¼ë“œ/ìŠ¬ë¦¼"],
      rectangle: ["í—ˆë¦¬ì„  ê°•ì¡°","ë²¨íŠ¸/í•€í„±","ë ˆì´ì–´ë“œë¡œ ë³¼ë¥¨","ì„¸ë¯¸ì˜¤ë²„"],
      hourglass: ["í—ˆë¦¬ ë¼ì¸ ìœ ì§€","í¬ë¡­/ì„¸ë¯¸í¬ë¡­ ìƒì˜","í•˜ì´ì›¨ì´ìŠ¤íŠ¸","ìŠ¬ë¦¼ ìŠ¤íŠ¸ë ˆì´íŠ¸"],
      round:     ["ìˆ˜ì§ ì‹¤ë£¨ì—£","ì§™ì€ í†¤ í†µì¼","Vë„¥/ë¡±ì•„ìš°í„°","ìŠ¤íŠ¸ë ˆì´íŠ¸/ë¶€ì¸ ì»·"],
      petite:    ["ì„¸ë¡œì„  ê°•ì¡°","í¬ë¡­ ìƒì˜","í•˜ì´ì›¨ì´ìŠ¤íŠ¸","ê³¼í•œ ì˜¤ë²„í• ì§€ì–‘"],
      tall:      ["ê°€ë¡œì„ /ë ˆì´ì–´ë“œ","ë¡±ì½”íŠ¸/ë¡±ê°€ë””ê±´","ì™€ì´ë“œ/í”Œë ˆì–´","ë‚®ì€ ëŒ€ë¹„í†¤"]
    };
    const occasionAdjust = {
      office: ["ì…”ì¸ /ë¸”ë¼ìš°ìŠ¤","í…Œì¼ëŸ¬ë“œ","ìŠ¬ë™ìŠ¤","ë¡œí¼/íŒí”„ìŠ¤"],
      date: ["ë¯¸ë””/ìŠ¬ë¦¼ ì‹¤ë£¨ì—£","ì†Œí”„íŠ¸ í…ìŠ¤ì²˜","í¬ì¸íŠ¸ ì»¬ëŸ¬"],
      travel: ["ì»´í¬íŠ¸/ì‹ ì¶•ì„±","ìŠ¤ë‹ˆì»¤ì¦ˆ","í¬ë¡œìŠ¤ë°±","ì•„ìš°í„° ë ˆì´ì–´ë“œ"],
      formal: ["ëª¨ë…¸í†¤/ë‹¤í¬í†¤","ë¯¸ë‹ˆë©€ ë””í…Œì¼","ì •ì¥í•"],
      guest: ["ì„¸ë¯¸í¬ë©€","ì›í”¼ìŠ¤/ìì¼“","ì ì ˆí•œ ê´‘íƒê°"]
    };
    const seasonAdjust = {
      spring: ["ë¼ì´íŠ¸ ì•„ìš°í„°","ì½”íŠ¼/ë¦°ë„¨","ë°ì€ ë‰´íŠ¸ëŸ´"],
      summer: ["í†µê¸°ì„± ì†Œì¬","ë°˜íŒ”/ìŠ¬ë¦¬ë¸Œë¦¬ìŠ¤","ë°ì€ ì¿¨í†¤"],
      autumn: ["ê°€ë””ê±´/íŠ¸ë Œì¹˜","ë‹ˆíŠ¸ í…ìŠ¤ì²˜","ì¹´ë©œ/ë¸Œë¼ìš´"],
      winter: ["ìš¸/íŒ¨ë”©","í„°í‹€ë„¥","ë¶€ì¸ ","í•˜ì´ì»¨íŠ¸ë¼ìŠ¤íŠ¸"]
    };

    // í”¼ë¶€í†¤(12ì‹œì¦Œ) ìƒ‰ìƒ í¬ì¸íŠ¸
    const skinToneAdjust = {
      // Spring
      springLight:  ["í”¼ì¹˜","ë¼ì´íŠ¸ ì½”ë„","ì•„ì¿ ì•„"],
      springWarm:   ["ì‚´ëª¬ í•‘í¬","ì• í”„ë¦¬ì½§","ê³¨ë“œ"],
      springBright: ["ë°ì€ í„°ì½°ì´ì¦ˆ","ë¼ì„","ë¸Œë¼ì´íŠ¸ ì½”ë„"],
      // Summer
      summerLight:  ["ë¼ì´íŠ¸ ë¼ì¼ë½","ë¯¼íŠ¸","ì†Œí”„íŠ¸ ë¸”ë£¨"],
      summerCool:   ["ë”ìŠ¤í‹° ë¡œì¦ˆ","ë¼ë²¤ë”","ì‹¤ë²„"],
      summerSoft:   ["ê·¸ë ˆì´ì‹œ ë¸”ë£¨","ë§ë¦°ì¥ë¯¸","ì„¸ì´ì§€"],
      // Autumn
      autumnSoft:   ["ì¹´í‚¤","ì›œ ê·¸ë ˆì´","ëª¨ìŠ¤ê·¸ë¦°"],
      autumnWarm:   ["ë¨¸ìŠ¤íƒ€ë“œ","ì¹´ë©œ","í…Œë¼ì½”íƒ€"],
      autumnDeep:   ["ë”¥ ì˜¬ë¦¬ë¸Œ","ì´ˆì½œë¦¿ ë¸Œë¼ìš´","ë²„ê±´ë””"],
      // Winter
      winterDeep:   ["ë”¥ ë„¤ì´ë¹„","ì™€ì¸","ì°¨ì½œ"],
      winterCool:   ["ì¥¬ì–¼í†¤ ë¸”ë£¨","ì•„ì´ì‹œ í•‘í¬","ì‹¤ë²„"],
      winterBright: ["í“¨ì–´ í™”ì´íŠ¸","íœ˜ì‹œì•„(í•«í•‘í¬)","ì½”ë°œíŠ¸"]
    };

    function baseRule(summary, tags){ return { summary, tags }; }
    function dedup(arr){ return [...new Set(arr)]; }
    function prettyOccasion(v){ return {office:"ì¶œê·¼", date:"ë°ì´íŠ¸", travel:"ì—¬í–‰", formal:"ê²©ì‹", guest:"í•˜ê°"}[v]||v; }
    function prettySeason(v){ return {spring:"ë´„", summer:"ì—¬ë¦„", autumn:"ê°€ì„", winter:"ê²¨ìš¸"}[v]||v; }

    // ===== ì¥ì  ë¬¸êµ¬(â‰¤30ì) =====
    function benefitText({autoShape, occasion, season, skinTone}){
      // ìš°ì„ ìˆœìœ„: ì²´í˜• â†’ ê³„ì ˆ/ìƒí™© â†’ í”¼ë¶€í†¤ í¬ì¸íŠ¸
      const byShape = {
        triangle:"ìƒí•˜ì²´ ë¹„ìœ¨ ë³´ì •, ìŠ¬ë¦¼í•´ ë³´ì„",
        inverted:"ìƒì²´ ë¶€ê° ì™„í™”, ê· í˜• ì¡íŒ ì‹¤ë£¨ì—£",
        rectangle:"í—ˆë¦¬ì„  ê°•ì¡°ë¡œ ë¹„ìœ¨ ê°œì„ ",
        hourglass:"í—ˆë¦¬ë¼ì¸ ì‚´ë ¤ ë” ê· í˜• ìˆê²Œ",
        round:"ìˆ˜ì§ ì‹¤ë£¨ì—£ë¡œ ë‚ ì”¬í•´ ë³´ì„",
        petite:"ì„¸ë¡œì„ /í•˜ì´ì›¨ì´ìŠ¤íŠ¸ë¡œ ê¸¸ì–´ ë³´ì„",
        tall:"ë ˆì´ì–´ë“œë¡œ ì•ˆì •ì  ë¹„ìœ¨ ì—°ì¶œ"
      }[autoShape];
      if(byShape) return byShape.slice(0,30);

      const byOcc = {
        office:"ë‹¨ì •Â·ì „ë¬¸ì  ì¸ìƒ ê°•í™”",
        date:"ë¶€ë“œëŸ½ê³  í˜¸ê°ë„ ë†’ì€ ë¬´ë“œ",
        travel:"í¸ì•ˆí•¨ê³¼ í™œë™ì„±ì„ ë™ì‹œì—",
        formal:"ê²©ì‹ê³¼ ì„¸ë ¨ë¯¸ë¥¼ ëª¨ë‘ ì¡ìŒ",
        guest:"ê³¼í•˜ì§€ ì•Šê²Œ í’ˆê²© ìˆëŠ” ì¸ìƒ"
      }[occasion];
      if(byOcc) return byOcc.slice(0,30);

      const bySeason = {
        spring:"ë°ê³  ì‚°ëœ»í•œ ì´ë¯¸ì§€ ì—°ì¶œ",
        summer:"ì‹œì›í•˜ê³  ì²­ëŸ‰í•œ ì¸ìƒ",
        autumn:"ìì—°ìŠ¤ëŸ¬ìš´ ê¹Šì´ê° ê°•ì¡°",
        winter:"ì„ ëª…í•œ ëŒ€ë¹„ë¡œ ë˜ë ·í•œ ì¸ìƒ"
      }[season];
      if(bySeason) return bySeason.slice(0,30);

      // í”¼ë¶€í†¤ í‚¤ì›Œë“œ
      const byTone = {
        springLight:"ë§‘ê³  í™”ì‚¬í•œ í†¤ì—… íš¨ê³¼",
        springWarm:"ì›œê´‘ì±„Â·ìƒê¸° ìˆëŠ” ì¸ìƒ",
        springBright:"ì„ ëª…í•œ ì»¬ëŸ¬ë¡œ í™œë ¥ ì—…",
        summerLight:"ë¶€ë“œëŸ½ê³  ê¹¨ë—í•œ ë¬´ë“œ",
        summerCool:"ì°¨ë¶„í•˜ê³  ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ì¿¨í†¤",
        summerSoft:"ì†Œí”„íŠ¸ í†¤ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ì›€",
        autumnSoft:"ì›œ ë‰´íŠ¸ëŸ´ë¡œ ì•ˆì •ê°",
        autumnWarm:"ë¦¬ì¹˜í•œ ì›œí†¤ìœ¼ë¡œ ìƒê¸°",
        autumnDeep:"ë”¥ ì»¬ëŸ¬ë¡œ ì¡´ì¬ê° ê°•í™”",
        winterDeep:"ê°•í•œ ëŒ€ë¹„ë¡œ ì¹´ë¦¬ìŠ¤ë§ˆ",
        winterCool:"ì°¨ê°€ìš´ ì¥¬ì–¼í†¤ìœ¼ë¡œ ì„ ëª…í•¨",
        winterBright:"ê³ ëª…ë„ ì»¬ëŸ¬ë¡œ ë˜ë ·í•¨"
      }[skinTone];
      return (byTone || "ë‹¹ì‹ ì—ê²Œ ê°€ì¥ ì˜ ë§ëŠ” ì¡°í•©").slice(0,30);
    }

    function recommend({age, gender, autoShape, occasion, season, skinTone}){
      const base = (baseRules[age] && baseRules[age][gender]) || baseRule("ë² ì´ì§ ë°ì¼ë¦¬", ["í‹°ì…”ì¸ ","ë°ë‹˜","ìŠ¤ë‹ˆì»¤ì¦ˆ"]);
      const adjustShape = shapeAdjust[autoShape] || [];
      const adjustOcc = occasionAdjust[occasion] || [];
      const adjustSeason = seasonAdjust[season] || [];
      const adjustSkin = skinToneAdjust[skinTone] || [];

      const summary =
        `ë¬´ë“œ: ${base.summary} Â· ì²´í˜•: ${autoShape? prettyShape(autoShape):"ê¸°ë³¸"} Â· ìƒí™©: ${prettyOccasion(occasion)} Â· ê³„ì ˆ: ${prettySeason(season)} Â· í”¼ë¶€í†¤: ${skinTone}`;
      const tags = dedup([...base.tags, ...adjustShape, ...adjustOcc, ...adjustSeason, ...adjustSkin]).slice(0, 12);

      return { summary, tags };
    }

    // ===== í‚¤ë³´ë“œ ì ‘ê·¼ì„± =====
    document.addEventListener('keydown',(e)=>{
      if(e.key==="Enter"){ document.getElementById("recommend").click(); }
    });

    // ===== ì €ì¥/ê°œì¸í™” =====
    const STORAGE = {
      saveSettings(data){ localStorage.setItem("settings", JSON.stringify(data)); },
      loadSettings(){ try { return JSON.parse(localStorage.getItem("settings")||"null"); } catch(e){return null;} },
      pushRecent(item){
        const arr = JSON.parse(localStorage.getItem("recent")||"[]");
        arr.unshift(item); if(arr.length>10) arr.pop();
        localStorage.setItem("recent", JSON.stringify(arr));
      },
      getRecent(){ return JSON.parse(localStorage.getItem("recent")||"[]"); },
      toggleFav(item){
        const arr = new Map(JSON.parse(localStorage.getItem("favs")||"[]"));
        const key = item.key;
        if(arr.has(key)) arr.delete(key); else arr.set(key, item);
        localStorage.setItem("favs", JSON.stringify([...arr.entries()]));
        return arr.has(key);
      },
      getFavs(){ return new Map(JSON.parse(localStorage.getItem("favs")||"[]")); }
    };

    function renderLists(){
      const recent = STORAGE.getRecent();
      const favs = STORAGE.getFavs();
      recentList.innerHTML = "";
      favList.innerHTML = "";
      recent.forEach(r=>{
        const li = document.createElement("li");
        li.textContent = `${r.summary}`;
        recentList.appendChild(li);
      });
      favs.forEach(v=>{
        const li = document.createElement("li");
        li.textContent = `${v.summary}`;
        favList.appendChild(li);
      });
    }

    // ===== UI ë°”ì¸ë”© =====
    const age = document.getElementById("age");
    const gender = document.getElementById("gender");
    const height = document.getElementById("height");
    const weight = document.getElementById("weight");
    const waist = document.getElementById("waist");
    const shoulder = document.getElementById("shoulder");
    const occasion = document.getElementById("occasion");
    const season = document.getElementById("season");
    const skinTone = document.getElementById("skinTone");
    const res = document.getElementById("result");
    const summaryEl = document.getElementById("summary");
    const benefitEl = document.getElementById("benefit");
    const tagsEl = document.getElementById("tags");
    const likeBtn = document.getElementById("likeBtn");
    const ctaBtn = document.getElementById("recommend");
    const saveBtn = document.getElementById("save");
    const resetBtn = document.getElementById("reset");
    const toast = document.getElementById("toast");
    const recentList = document.getElementById("recentList");
    const favList = document.getElementById("favList");

    function toastMsg(msg){
      toast.textContent = msg;
      toast.style.display = "block";
      setTimeout(()=> toast.style.display="none", 1300);
    }

    [height, weight, waist, shoulder].forEach(i=> i.addEventListener('input', autoBodyType));

    function currentInput(){
      const inferredShape = autoBodyType();
      return {
        age: age.value,
        gender: gender.value,
        autoShape: inferredShape || "rectangle",
        occasion: occasion.value,
        season: season.value,
        skinTone: skinTone.value
      };
    }

    function runRecommend(){
      const input = currentInput();
      const { summary, tags } = recommend(input);
      summaryEl.textContent = summary;
      benefitEl.textContent = benefitText(input); // <= ì¥ì  í•œ ì¤„ (â‰¤30ì)
      tagsEl.innerHTML = "";
      tags.forEach(t=>{
        const span = document.createElement("span");
        span.className = "tag"; span.textContent = t;
        tagsEl.appendChild(span);
      });
      res.style.display = "block";

      STORAGE.pushRecent({ key: String(Date.now()), summary });
      renderLists();
      logEvent("recommend_click", input);
    }

    ctaBtn.addEventListener('click', runRecommend);
    likeBtn.addEventListener('click', ()=>{
      const item = { key: "fav:"+summaryEl.textContent.slice(0,80), summary: summaryEl.textContent };
      const nowLiked = STORAGE.toggleFav(item);
      likeBtn.textContent = nowLiked ? "ğŸ’– ì¦ê²¨ì°¾ê¸°" : "ğŸ¤ ì¦ê²¨ì°¾ê¸°";
      likeBtn.setAttribute("aria-pressed", nowLiked ? "true":"false");
      toastMsg(nowLiked ? t("liked") : t("unliked"));
      renderLists();
      logEvent("favorite_toggle", { liked: nowLiked });
    });

    saveBtn.addEventListener('click', ()=>{
      const s = currentInput();
      STORAGE.saveSettings(s);
      toastMsg(t("saved"));
      logEvent("save_settings", s);
    });

    resetBtn.addEventListener('click', ()=>{
      age.value = "10"; gender.value = "female";
      [height,weight,waist,shoulder].forEach(i=> i.value = "");
      occasion.value = "office"; season.value="spring";
      skinTone.value="springLight";
      res.style.display = "none"; summaryEl.textContent=""; tagsEl.innerHTML=""; benefitEl.textContent="";
      autoShapeNote.textContent="";
      likeBtn.textContent="ğŸ¤ ì¦ê²¨ì°¾ê¸°"; likeBtn.setAttribute("aria-pressed","false");
      toastMsg(t("cleared"));
      logEvent("reset");
    });

    // ì´ˆê¸° ë¡œë“œ
    (function init(){
      applyLang();
      const s = STORAGE.loadSettings();
      if(s){
        age.value = s.age || "10";
        gender.value = s.gender || "female";
        occasion.value = s.occasion || "office";
        season.value = s.season || "spring";
        skinTone.value = s.skinTone || "springLight";
      }
      autoBodyType();
      renderLists();
    })();
  </script>
</body>
</html>
